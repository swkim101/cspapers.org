In recent years, the swift expansion of Internet of Things (IoT) applications has been notable. However, developing a comprehensive IoT application is highly challenging for non-expert developers due to the highly diverse characteristics of embedded operating systems. The LLM-based approach shows promise in generating code from natural language, but its performance in IoT code generation is poor. This stems from the LLM's insufficient understanding of the embedded IoT code context, leading to missed and conflicting OS-specific APIs. In this paper, we present IoTPilot, a LLM-driven multi-agent IoT programming framework. We develop a clustering-based progressive RAG strategy and auto-calibrating self-debug mechanism to enhance the quality of generated IoT applications.