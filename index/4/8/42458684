We study how to optimally attract new customers using a referral program. Whenever a consumer makes a purchase, the firm gives her a link to share with friends, and every purchase coming through that link generates a referral payment. The firm chooses the referral payment function and consumers play an equilibrium in response. The optimal payment function is nonlinear and not necessarily monotonic in the number of successful referrals. If we approximate the optimal policy using a linear payment function, the approximation loss scales with the square root of the average consumer degree. Using a threshold payment, the approximation loss scales proportionally to the average consumer degree. Combining the two, using a linear payment function with a threshold bonus, we can achieve a constant bound on the approximation loss.