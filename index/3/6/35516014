We study mechanisms for environments in which only some of the agents are directly connected to a mechanism designer and the other agents can participate in a mechanism only through the connected agents' referrals. Agents' network connections are private information, which can be strategically concealed by avoiding making referrals; while the mechanism designer wants to elicit the agents' private information about both payoff types and network connections. The set of feasible allocations is endogenously determined by the actual participants induced by referrals. In such an environment with a varying population, we define a VCG mechanism as a benchmark for an efficient mechanism. It is incentive compatible and individually rational, but it generically runs a deficit as it requires too much compensation for referrals. Alternatively as a budget-surplus mechanism, we introduce a multilevel mechanism, in which each agent is compensated by the agents who would not be able to participate without her referrals. Under a multilevel mechanism, we show that fully referring one's acquaintances is a dominant strategy and agents have no incentive to under-report their payoff type if the social welfare is submodular. As applications, a single-item auction and a public good provision game are studied. We show that a multilevel mechanism guarantees a revenue higher than any standard auction. In a public good provision game, a principal can achieve an efficient and budget-balanced allocation through a multilevel mechanism if the agents have a binary preference on the public good.