Under full substitutability of preferences, it has been shown that a competitive equilibrium exists in trading networks, and is equivalent (after a restriction to equilibrium trades) to (chain) stable outcomes. In this paper, we formulate the problem of finding an efficient outcome as a generalized submodular flow problem on a suitable network. Equivalence with seemingly weaker notions of stability follows directly from the optimality conditions, in particular the absence of improvement cycles in the flow problem. Our formulation yields strongly polynomial algorithms for finding competitive equilibria in trading networks, and testing (chain) stability.