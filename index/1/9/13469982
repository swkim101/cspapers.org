The representation used in a domain-independent planning program that supports both automatic and interactive generation of hierarchical, partially ordered plans is described. An improved formalism for representing domains and actions is presented. The formalism makes extensive use of constraints, offers efficient methods for representing properties of objects that do not change over time, allows specification of plan rationale, allows specification of resources for efficiently detecting and remedying harmful parallel interactions, and provides the ability to express deductive rules for deducing the effects of actions.