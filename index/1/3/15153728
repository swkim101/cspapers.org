We introduce a new matching model in which firms trade goods via bilateral contracts which specify a buyer, a seller, and the terms of the exchange. This framework subsumes all classical matching models, including that of Ostrovsky [5]. The generality our model affords allows us to make two substantial contributions.
 First, we show that two theoretical restrictions are necessary for classical matching theory: acyclicity - no agent may both buy from and sell to another agent, even through intermediaries, an. full substitutability - upon being endowed with an additional item, an agent's demand for other items is lower, both in the sense of a reduced desire to buy additional items and an increased desire to sell items he currently owns.1
 If either condition is violated, then existence of stable allocations cannot be guaranteed.2 Intuitively, if a contracting relationship contains a cycle, and if a firm in the cycle has an outside option which is preferred to one contract in the cycle, then both the outside option and the complete trading cycle are unstable; the necessity of acyclicity follows. The necessity of full substitutability is more technical, but follows closely upon prior results of Hatfield and Kominers [2].
 Second, in the presence of acyclicity and fully substitutable preferences, we fully generalize the key results of classical matching theory. We prove that under these conditions stable allocations correspond bijectively to fixed points of an isotone operator; Tarski's fixed point theorem then guarantees the existence of a lattice of stable allocations. We also prove a generalization of the classical rural hospitals theorem of Roth [6] and the strategy-proofness results of Hatfield and Milgrom [3] and Hatfield and Kojima [1].3 These latter results display a surprising structure which can only be elicited within a framework as general as ours: in particular, we show that the difference between the numbers of buy- and sell-contracts held, rather than the absolute number of contracts held, is invariant across stable allocations for each agent.
 In light of our necessity results, our work establishes a frontier of matching theory. Without acyclicity and fully substitutable preferences, stable allocations are not guaranteed to exist in general, and hence the results of classical matching theory fail. Up to the failure of these conditions, however, all of the results of classical matching theory hold.