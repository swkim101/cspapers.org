Recently, the demand to manipulate deformable objects such as a string and cloth by robots is growing. The reason is that it has the possibility of making our lives more convenient in many domains. The manipulation of deformable objects, however, is more difficult than that of rigid objects, because deformable objects have diversity of shape and behavior. Therefore, our research group has been focusing on the string shape operation. This paper describes planning method of string untying operation based on knot theory and algorithms to generate the motion of a manipulator. The novel contribution of our planning method is automatic selection of optimal shape operation based on cost function. At final, the results of string untying experiments are reported.