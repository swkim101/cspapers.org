We study the optimal design of a queueing system when agents' arrival and servicing are governed by a general Markov process. The designer of the system chooses entry and exit rules for agents, their service priority---or queueing discipline---as well as their information, while ensuring that agents have incentives to follow the designer's recommendations not only to join the queue but more importantly to stay in the queue. Under a mild condition, the optimal mechanism has a cutoff structure---agents are induced to enter up to a certain queue length and no agents are to exit the queue once they enter the queue; the agents on the queue are served according to a first-come-first-served (FCFS) rule; and they are given no information throughout the process beyond the recommendations they receive from the designer. FCFS is also necessary for optimality in a rich domain. We identify a novel role for queueing disciplines in regulating agents' beliefs, and their dynamic incentives, thus uncovering a hitherto unrecognized virtue of FCFS in this regard.