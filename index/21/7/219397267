Many users have reported that their smartphones shut off unexpectedly, even when they show >30% remaining battery capacity. After examining the problem from both the user and phone sides, we discovered the cause of these unexpected shutoffs to be a large and dynamic internal voltage drop of the phone battery, which is, in turn, caused by the dynamics of both battery's internal resistance and the phone's discharge current. To fix these unexpected shutoffs, we design a novel Battery-aware Power Management (BPM) middleware that accounts for these dual-dynamics in phone operation. Specifically, BPM profiles the battery's internal resistance --- which varies with battery state-of-charge (SoC), temperature, and aging --- using a novel duty-cycled charging method. BPM then regulates, at run-time, the phone's discharge current based on the constructed battery profile. We have implemented and evaluated BPM on 4 commodity smartphones from different OEMs with the latest battery firmware, demonstrating that BPM prevents unexpected phone shutoffs and extends their operation time by 1.16--2.03X. Our user study, which includes 121 mobile phone users, also corroborates BPM's usefulness/attractiveness.