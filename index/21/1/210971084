Unmanned surface vehicles (USVs) are typically designed for open area marine applications. In this paper, we present a new autonomy system (Roboat) for urban waterways which requires robust localization, perception, planning, and control. A novel localization system, based on the extended Kalman filter (EKF), is proposed for USVs, which utilizes LiDAR, camera, and IMU to provide a decimeter-level precision in dynamic GPS-attenuated urban waterways. Area and shape filters are proposed to crop water reflections and street obstacles from a pointcloud. Euclidean clustering and multi-object contour tracking are then introduced to detect and track the static and moving objects reliably in urban waters. An efficient path planner is tailored to calculate optimal trajectories to avoid these static and dynamic obstacles. Lastly, a nonlinear model predictive control (NMPC) scheme with full state integration is formulated for the four-control-input robot to accurately track the trajectory from the planner in rough water. Extensive experiments show that the robot is able to autonomously navigate in both the indoor waterway and the cluttered outdoor waterway in the presence of static and dynamic obstacles, implying that Roboat could have a great impact on the future of transportation in many coastal and riverside cities.