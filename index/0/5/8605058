Although considering dynamics in the control of humanoid robots can improve tracking and compliance in agile tasks, it requires local and global states of the system, precise torque control and proper modeling. In this paper we discuss practical issues to implement inverse dynamics on a torque controlled robot. By modeling electrical actuators offline, inverting such model and estimating the friction on-line, a high bandwidth torque controller is implemented. In addition, a cascade of optimization problems to fuse all the sensory data coming from IMU, joint encoders and contact force sensors estimate the robot's global state robustly. Our estimation builds the kinematic chain of the legs from the center of pressure which is more robust in case of slight slippage, tilting or rolling of the feet. Thanks to precise and fast torque control, robust state estimation and optimization-based whole body inverse dynamics, the real robot can keep balance with very small stiffness and damping in Cartesian space. It can also recover from strong pushes and perform dexterous tasks. The highly compliant and stable performance is based on pure torque control, without any joint damping or position/velocity tracking.