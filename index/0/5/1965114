We study the envy-free pricing problem faced by a profit maximizing seller when there is metric substitutability among the items --- consumer i's value for item j is vi -- ci,j, and the substitution costs, {ci,j}, form a metric. Our model is motivated from the observation that sellers often sell the same product at different prices in different locations, and rational consumers optimize the tradeoff between prices and substitution costs. While the general envy-free pricing problem is hard to approximate, the addition of metric substitutability constraints allows us to solve the problem exactly in polynomial time by reducing it to an instance of weighted independent set on a perfect graph.
 When the substitution costs do not form a metric, even in cases when a (1+Îµ)--approximate triangle inequality holds, the problem becomes NP-hard. Our results show that triangle inequality is the exact sharp threshold for the problem of going from "tractable" to "hard".
 We then turn our attention to the multi-unit demand case, where consumers request multiple copies of the item. This problem has an interesting paradoxical non-monotonicity: The optimal revenue the seller can extract can actually decrease when consumers' demands increase. We show that in this case the revenue maximization problem becomes APX-hard and give an O(log D) approximation algorithm, where D is the ratio of the largest to smallest demand. We extend these techniques to the more general case of arbitrary non-decreasing value functions, and give an O(log3 D) approximation algorithm.