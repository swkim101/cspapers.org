Agile robot locomotion on rough terrain is highly dependent on the ability to perceive the environment. In this paper, we show how the interaction between a reactive control framework and an online mapping system can significantly improve the trotting performance on irregular terrain. In particular, this new locomotion controller increases the stability of the robot and reduces frontal leg and shin collisions with obstacles by correcting in realtime the foothold locations. The mapping system uses an RGB-D sensor and a motion capture system to build a three dimensional map of the surroundings of the robot. While the robot is trotting, the control framework requests in advance a local heightmap around the next nominal foothold position. Then, an optimized foot placement location is estimated by applying visual pattern classification on the acquired heightmaps, and the leg endpoint trajectory is modified accordingly. The foothold correction is performed independently for each leg. To show the effectiveness of our approach the controller was tested both in simulation and experimentally with our 80 kg hydraulic quadruped robot, HyQ. The results show that visual based reaction through pattern classification is a promising approach to increase locomotion robustness over challenging terrain.