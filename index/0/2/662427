This paper describes a system enabling automatic indoor floor map generation using a smart phone equipped with an ultrasonic sensor gadget. First, it estimates the size, shape and direction of the room by exploiting the ultrasonic sensors and builtin accelerometer and geomagnetic sensor of the smart phone. Second, it estimates the rough location of each room by using WiFi indoor localization and generates an accurate floor map by estimating the contiguity relationship between rooms. We implemented a prototype of the proposed system and estimated the room size, shape and direction through an experiment. As a result, the system could estimate the lengths of the room sides with errors of about 6.1% and about 18.9%.