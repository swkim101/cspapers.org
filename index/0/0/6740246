This paper describes an algorithm for pose and illumination invariant face recognition from a single image under occlusions. The method iteratively estimates the parameters of a 3D morphable face model to approximate the appearance of a face in an image. Simultaneously, a visibility map is computed which segments the image into visible and occluded regions. The visibility map is incorporated into a probabilistic image formation model as a set of spatially correlated random variables. This leads to a Generalized Expectation-Maximization algorithm in which the estimation of the morphable model related parameters is interleaved with visibility computations. The validity of the algorithm is verified by a face recognition experiment using images from the publicly available AR Face Database.