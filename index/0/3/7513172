We present a method for designing a walking controller for the walking robot Cornell Ranger. Our goal is a controller that can be designed using model-based optimization, and then transferred directly to the robot without the need for after-the-fact hand-tuning. The structure of the controller is hierarchical, with a high-level balance controller that plans step-to-step motions, and a lower-level joint controller that coordinates the individual joint motors to achieve the desired limb motions. The balance controller is designed through optimization, with the explicit goals of a) achieving a desired walking speed while b) minimizing energy use and c) avoiding falls due to disturbances. We demonstrate this walking controller on the Cornell Ranger, and find that the resulting gait is comparable to that of a previous (hand-tuned) controller, with regard to energy use, speed regulation, and fall prevention.