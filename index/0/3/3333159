People spend approximately 70% of their time indoors. Understanding the indoor environments is therefore important for a wide range of emerging mobile personal and social applications. Knowledge of indoor floorplans is often required by these applications. However, indoor floorplans are either unavailable or obtaining them requires slow, tedious, and error-prone manual labor. This paper describes an automatic indoor floorplan construction system. Leveraging Wi-Fi fingerprints and user motion information, this system automatically constructs floorplan via three key steps: (1) room adjacency graph construction to determine which rooms are adjacent; (2) hallway layout learning to estimate room sizes and order rooms along each hallway, and (3) force directed dilation to adjust room sizes and optimize the overall floorplan accuracy. Deployment study in three buildings with 189 rooms demonstrates high floorplan accuracy. The system has been implemented as a mobile middleware, which allows emerging mobile applications to generate, leverage, and share indoor floorplans.