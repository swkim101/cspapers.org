Identifying electrical signatures preceding a ventricular arrhythmia from the implantable cardioverter-defibrillators (ICDs) can help predict an upcoming ICD shock. To achieve this, we first deployed a large-scale study (N=326) to continuously monitor the electrogram (EGM) data from the ICDs and select the EGM segments prior to a shock event and under the normal condition. Next, we design a novel cohesive framework that integrates metric learning, prototype learning, and few-shot learning, enabling learning from an imbalanced dataset. We implement metric learning by leveraging a Siamese neural network architecture, which incorporates LSTM units. We innovatively utilize triplet and pair losses in a sequential manner throughout the training process on EGM samples. This approach generates embeddings that significantly enhance the distinction of EGM signals under different conditions. In the inference stage, k-means clustering identifies prototypes representing pre-shock and normal states from these embeddings. In summary, this framework leverages the predictive potential of signals before ICD shocks, addressing the gap in early cardiac arrhythmia detection. Our experimental results show a notable F1 score of 0.87, sensitivity of 0.97, and precision of 0.79. Our framework offers a significant advancement in cardiac care predictive analytics, promising enhanced ICD decision-making for improved patient outcomes.